# 프로젝트 명세

## **⚡ 도파민 스토어: 블랙 프라이데이 실시간 선착순 판매 시스템**

[화면 기록 2025-11-08 오후 8.29.08.mov](%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8%20%EB%AA%85%EC%84%B8/%E1%84%92%E1%85%AA%E1%84%86%E1%85%A7%E1%86%AB_%E1%84%80%E1%85%B5%E1%84%85%E1%85%A9%E1%86%A8_2025-11-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_8.29.08.mov)

**도파민스토어(Dopamine Store)**는 물건과 함께 ‘획득의 짜릿함’을 판매합니다.

매일 오전 10시, 한정된 재고의 다양한 상품이 선착순으로 판매되며, 사용자는 원하는 물품을 손에 넣는 동시에 도파민을 얻게 됩니다.

이 시스템의 핵심 목표는 다음과 같습니다:

- **10시 정각에 동시 접속한 10만 명의 요청을 안정적으로 처리(초당 10만 request)** (서버 다운 방지)
- **공정한 선착순 처리 로직**으로 정확히 N명에게만 구매 성공을 보장

---

## **🧩 1. 시스템 정책 개요**

### **🎁 상품**

 **정책 (Product Policy)**

- 모든 상품은 등록 시 **판매일자(sale_date)** 와 **재고(stock)** 를 반드시 지정해야 함.
- 각 상품은 **고유한 구매 신청 페이지**를 가짐.
- 상품별로 재고 수만큼의 **구매 권한(PurchaseSlot)** 이 생성됨.
- 상품은 **어드민(Admin)** 계정에 의해 등록 및 관리됨.

**주요 도메인 책임**

- 상품 등록 / 수정 / 삭제 / 조회
- 재고 관리 (Stock Management)
- 판매 일정 관리 (Sale Schedule)

---

### **💳 구매**

**정책 (Purchase Slot Policy)**

- 구매자는 **선착순으로 구매 권한(Purchase Slot)** 을 획득함.
- 구매 권한은 상품의 실제 결제(Purchase)를 위한 사전 조건.
- 구매 권한은 **30분간 유효**하며, 이 내에 결제가 완료되지 않으면 만료됨.
- 만료된 슬롯은 시스템에 의해 자동 회수(Reclaimed)될 수 있음.

**주요 도메인 책임**

- 구매 권한 신청 (Obtain Purchase Slot)
- 구매 권한 목록 조회 (List My Slots)
- 구매 권한 만료 처리 (Expire Slot)
- 만료 알림 (Pre-expiration Notification, e.g. “5분 전 알림”) **(Advanced)**

---

### **💰 결제 - Advanced (빨리하면 ㄱㄱ)**

**정책 (Payment Policy)**

- 구매 권한을 획득한 사용자만 결제를 진행할 수 있음.
- 결제 완료 시, 구매 상태는 **확정(Confirmed)** 으로 변경됨.
- 결제 수단은 추후 확장 가능 (예: 카드, 포인트, 간편결제 등).
- 결제가 완료되면 재고 차감은 이미 선점된 상태이므로, 이중 결제 방지 로직은 필요 없음.

**주요 도메인 책임**

- 결제 요청 및 승인 (Initiate & Confirm Payment)
- 결제 상태 관리 (Pending / Success / Failed)
- 영수증 및 결제 결과 알림

---

### **👤 유저 / 인증**

**정책 (User & Auth Policy)**

- 모든 사용자는 **구매자(Buyer)** 로 가입.
- 회원가입 시: 아이디, 비밀번호, 이메일 을 필수로 입력.
- 아이디는 중복 불가.
- 이메일 인증은 선택적(정책상 제외 가능).
- JWT 또는 세션 기반 토큰 발급 정책 적용 가능.

**주요 도메인 책임**

- 회원가입 (Sign Up)
- 로그인 (Sign In)
- 비밀번호 찾기 (Find Password)
- 인증 토큰 발급 (Token Issue)
- Advanced - 카프카 큐에 두 구매 권한 요청을 넣는 것을 방지하려면(?)

---

### **🔔 알림**

**정책 (Notification Policy)**

- 알림 서비스는 각 도메인으로부터 **메시지 Body** 만 전달받음.
    
    (비즈니스 로직은 수행하지 않음)
    
- 알림 전송 방식:
    - 즉시 전송 (Immediate)
    - 예약 전송 (Scheduled)
- 실제 전송 구현체는 외부 서비스 연동으로 구성 (예: **Gmail**, Slack, Discord 등)

**주요 도메인 책임**

- 알림 요청 처리 (Receive Notification Request)
- 알림 스케줄링 (Immediate or Timed)
- 전송 상태 로깅 (Success / Fail)
- 예시 알림 유형:
    - 회원가입 완료
    - 비밀번호 재설정
    - 구매 권한 획득 성공
    - 구매 권한 만료 예정 (5분 전)

---

## **🧱 2. 주요 도메인 개요**

| **도메인** | **영문명** | **정의** | **주요 기능** |
| --- | --- | --- | --- |
| 상품 | **Product** | 사용자가 구매할 수 있는 개별 아이템 또는 서비스 | 등록, 수정, 삭제, 재고 관리, 신청 페이지 관리 |
| 구매 권한 | **PurchaseSlot** | 상품을 결제할 수 있는 권한. 선착순으로 획득 | 권한 획득, 조회, 만료, 알림 |
| 결제 | **Purchase** | 구매 권한을 가진 사용자가 실제 결제 | 결제 요청, 결제 완료 처리 |
| 유저 / 인증 | **User / Auth** | 시스템에 가입하고 인증을 통해 접근하는 주체 | 회원가입, 로그인, 토큰 발급 |
| 알림 | **Notification** | 각 도메인의 이벤트 발생 시 외부 채널로 알림 전송 | 알림 요청 수신, 전송, 스케줄 관리 |

## **🧭 3. 도메인 관계 모델 (개념 구조)**

```json
User
 ├── has many PurchaseSlots
 │     ├── belongs to Product
 │     ├── can expire after 30 mins
 │     └── leads to Purchase (Payment)
 └── triggers Notifications
Product
 ├── has many PurchaseSlots
 └── managed by Admin
```

## 4. 모니터링

- **kafka ui** 붙이기 → consumer lag이 얼마나 빠지는 지,
- 그라파나.. (advanced)

---

### 일정

- 공식문서 스터디를 빠르게 끝내고, 본격적인 프로젝트 시작
- 10-20m 정도 요구사항 명세 구체화
- 기획은 공식문서 스터디 중에 완료

[User Flow](https://www.notion.so/User-Flow-2aea2b2d9f9380db847eea1d41847c47?pvs=21)